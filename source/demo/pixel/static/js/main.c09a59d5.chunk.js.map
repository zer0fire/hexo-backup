{"version":3,"sources":["PixelGrid.tsx","ColorSelect.tsx","OnlineCount.tsx","App.tsx","index.tsx"],"names":["_regeneratorRuntime","exports","Op","Object","prototype","hasOwn","hasOwnProperty","defineProperty","obj","key","desc","value","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","makeInvokeMethod","tryCatch","fn","arg","type","call","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","method","_invoke","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","record","result","__await","then","unwrapped","error","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","done","methodName","undefined","return","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","length","i","displayName","isGeneratorFunction","genFun","ctor","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","keys","val","object","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","canvasStyle","display","boxShadow","createImageFromArrayBuffer","buf","blob","Blob","image","Image","url","URL","createObjectURL","onload","src","getMousePose","e","layerX","layerY","zoom","target","style","transform","match","Math","floor","PixelGrid","_Component","props","_this","_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","socket","canvas","canvasWrapper","ctx","handleDotClick","row","zoomLevel","col","emit","color","currentColor","setUpZoomHandler","addEventListener","newZoomLevel","mouseLayerX","mouseLayerY","a","b","deltaY","x","y","l2","parseFloat","left","t2","top","setState","preventDefault","setUpDragHandler","initialLeft","initialTop","mouseInitialX","mouseInitialY","mouseMoveX","mouseMoveY","dragging","clientX","clientY","dotHoveX","dotHoveY","window","mouseX","mouseY","mouseMoveDistance","sqrt","pow","console","log","isPickingColor","setUpPickColorHandler","_getMousePose","_getMousePose2","_slicedToArray","cursorUrl","cursor","document","createElement","getContext","width","height","beginPath","lineWidth","strokeStyle","moveTo","lineTo","stroke","arc","PI","fillStyle","fill","toDataURL","makeCursor","Array","from","getImageData","data","concat","_getMousePose3","_getMousePose4","hexColor","map","it","toString","padStart","join","onPickColor","setPickColor","draw","fillRect","_inherits","_createClass","_this2","imageRendering","on","_ref","_asyncToGenerator","_callee","pixelData","_context","drawImage","forceUpdate","_x","apply","arguments","_ref2","el","getElementById","ReactDOM","createPortal","React","marginLeft","onClick","_this3","overflow","margin","border","position","renderPickColorBtn","ref","className","zIndex","pointerEvents","_objectSpread","transformOrigin","Component","colors","ulStyle","padding","marginRight","float","liStyle","listStyle","btnStyle","ColorSelect","onChange","backgroundColor","OnlineCount","count","_useState","useState","_useState2","setCount","useOnlineCount","App","_getPrototypeOf2","_len","args","_key","io","handlePixelClick","changeCurrentColor","onPixelClick","id","render"],"mappings":"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","file":"static/js/main.c09a59d5.chunk.js","sourcesContent":["import React, { Component } from \"react\";\n// import React from 'react';\nimport ReactDOM from \"react-dom\";\n\nconst canvasStyle = {\n  display: \"block\",\n  boxShadow: \"0px 0px 3px black\",\n};\n\nfunction createImageFromArrayBuffer(buf): Promise<any> {\n  return new Promise((resolve) => {\n    var blob = new Blob([buf], { type: \"image/jpeg\" });\n    var image = new Image();\n    var url = URL.createObjectURL(blob);\n    image.onload = function () {\n      resolve(image);\n    };\n    image.src = url;\n    // return image\n  });\n}\n\nfunction getMousePose(e) {\n  var layerX = e.layerX;\n  var layerY = e.layerY;\n  var zoom = e.target.style.transform.match(/scale\\((.*?)\\)/)[1];\n  return [Math.floor(layerX / zoom), Math.floor(layerY / zoom)];\n}\n\ninterface State {\n  zoomLevel: number;\n  dotHoveX: number;\n  dotHoveY: number;\n  isPickingColor: boolean;\n  width: number;\n  height: number;\n}\ninterface Props {\n  socket: any;\n  currentColor: any;\n  onPickColor: Function;\n  width: number;\n  height: number;\n  onPixelClick: Function;\n}\n\nclass PixelGrid extends Component<Props, State> {\n  socket: any;\n  canvas: HTMLCanvasElement | null;\n  canvasWrapper: HTMLElement | null;\n  ctx: CanvasRenderingContext2D | null;\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      zoomLevel: 1,\n      dotHoveX: -1,\n      dotHoveY: -1,\n      isPickingColor: false,\n      width: 0,\n      height: 0,\n    };\n\n    this.socket = this.props.socket;\n    this.canvas = null;\n    this.canvasWrapper = null;\n    this.ctx = null;\n    // this.zoomLevel = 1\n  }\n\n  handleDotClick = (e) => {\n    var layerX = e.layerX;\n    var layerY = e.layerY;\n    // e.nativeEvent.offsetX  也能解决点不准问题\n    var row = Math.floor(layerY / this.state.zoomLevel);\n    var col = Math.floor(layerX / this.state.zoomLevel);\n\n    // console.log(row, col)\n    this.socket.emit(\"draw-dot\", { row, col, color: this.props.currentColor });\n  };\n\n  setUpZoomHandler = () => {\n    this.canvas &&\n      this.canvas.addEventListener(\"mousewheel\", (e: any) => {\n        // console.log(e)\n\n        var mouseLayerX = e.layerX;\n        var mouseLayerY = e.layerY;\n        var newZoomLevel;\n        var oldZoomLevel = this.state.zoomLevel;\n\n        if (e.deltaY < 0) {\n          newZoomLevel = this.state.zoomLevel + 1;\n        } else {\n          newZoomLevel = this.state.zoomLevel - 1;\n        }\n\n        // var zoomRatio = newZoomLevel / oldZoomLevel\n\n        // l2 = ((a / b - 1) * x + l1 * a ) / b\n\n        var a = oldZoomLevel;\n        var b = newZoomLevel;\n        var x = mouseLayerX;\n        var y = mouseLayerY;\n        // 用zoom，需要重排和计算放大倍数给left和top的影响\n        // var l1 = parseFloat(this.canvas.style.left)\n        // var l2 = (-(b / a - 1) * x + l1 * a ) / b\n        // var t1 = parseFloat(this.canvas.style.top)\n        // var t2 = (-(b / a - 1) * y + t1 * a ) / b\n\n        // 用transform，不必重排\n        if (this.canvasWrapper) {\n          var l1 = parseFloat(this.canvasWrapper.style.left);\n          var l2 = l1 - (b / a - 1) * x;\n          var t1 = parseFloat(this.canvasWrapper.style.top);\n          var t2 = t1 - (b / a - 1) * y;\n\n          if (newZoomLevel < 1) {\n            // 缩放系数小于1时复位\n            newZoomLevel = 1;\n            l2 = 0;\n            t2 = 0;\n          }\n\n          this.canvasWrapper.style.left = l2 + \"px\";\n          this.canvasWrapper.style.top = t2 + \"px\";\n\n          this.setState({\n            zoomLevel: newZoomLevel,\n          });\n\n          e.preventDefault();\n        }\n      });\n  };\n\n  setUpDragHandler = () => {\n    var initialLeft;\n    var initialTop;\n    var mouseInitialX;\n    var mouseInitialY;\n    var mouseMoveX;\n    var mouseMoveY;\n    var dragging = false;\n    if (!this.canvasWrapper || !this.canvas) {\n      return;\n    }\n    this.canvasWrapper.addEventListener(\"mousedown\", (e) => {\n      if (this.canvasWrapper) {\n        initialLeft = parseFloat(this.canvasWrapper.style.left);\n        initialTop = parseFloat(this.canvasWrapper.style.top);\n        mouseInitialX = e.clientX;\n        mouseInitialY = e.clientY;\n        dragging = true;\n      }\n    });\n    this.canvas.addEventListener(\"mousemove\", (e: any) => {\n      let x = 0;\n      if (e && e.layerX) {\n        x = Math.floor(e.layerX / this.state.zoomLevel);\n      }\n      var y = Math.floor(e.layerY / this.state.zoomLevel);\n      this.setState({\n        dotHoveX: x,\n        dotHoveY: y,\n      });\n    });\n    window.addEventListener(\"mousemove\", (e) => {\n      if (dragging) {\n        var mouseX = e.clientX;\n        var mouseY = e.clientY;\n        mouseMoveX = mouseX - mouseInitialX;\n        mouseMoveY = mouseY - mouseInitialY;\n        var left = initialLeft + mouseMoveX;\n        var top = initialTop + mouseMoveY;\n        if (this.canvasWrapper) {\n          this.canvasWrapper.style.left = left + \"px\";\n          this.canvasWrapper.style.top = top + \"px\";\n        }\n      }\n    });\n    window.addEventListener(\"mouseup\", (e) => {\n      dragging = false;\n    });\n    this.canvasWrapper.addEventListener(\"mouseup\", (e) => {\n      dragging = false;\n      var mouseMoveDistance = Math.sqrt(mouseMoveX ** 2 + mouseMoveY ** 2);\n      console.log(mouseMoveDistance);\n      if (mouseMoveDistance < 3 && !this.state.isPickingColor) {\n        this.handleDotClick(e);\n        console.log(\"click\", \"pick state\", this.state.isPickingColor);\n      }\n      mouseMoveX = 0;\n      mouseMoveY = 0;\n    });\n  };\n  setUpPickColorHandler = () => {\n    function makeCursor(color) {\n      var cursor = document.createElement(\"canvas\");\n      var ctx = cursor.getContext(\"2d\");\n      cursor.width = 41;\n      cursor.height = 41;\n\n      if (ctx) {\n        ctx.beginPath();\n        ctx.lineWidth = 2;\n        ctx.strokeStyle = \"#000000\";\n        ctx.moveTo(0, 6);\n        ctx.lineTo(12, 6);\n        ctx.moveTo(6, 0);\n        ctx.lineTo(6, 12);\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.arc(25, 25, 14, 0, 2 * Math.PI, false);\n        ctx.lineWidth = 2;\n        ctx.strokeStyle = \"#000000\";\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.arc(25, 25, 13.4, 0, 2 * Math.PI, false);\n        ctx.fillStyle = color;\n        ctx.fill();\n      }\n\n      return cursor.toDataURL();\n    }\n\n    this.canvas &&\n      this.canvas.addEventListener(\"mousemove\", (e) => {\n        if (this.state.isPickingColor && this.ctx) {\n          var [x, y] = getMousePose(e);\n          // console.log(x, y)\n          var pixelColor = Array.from(this.ctx.getImageData(x, y, 1, 1).data);\n          var pixelColorCss = \"rgba(\" + pixelColor + \")\";\n          // console.log(pixelColor, pixelColorCss)\n          var cursorUrl = makeCursor(pixelColorCss);\n          if (this.canvas) {\n            this.canvas.style.cursor = `url(${cursorUrl}) 6 6, crosshair`;\n          }\n        }\n      });\n    this.canvas &&\n      this.canvas.addEventListener(\"click\", (e) => {\n        if (this.state.isPickingColor && this.ctx) {\n          var [x, y] = getMousePose(e);\n          var pixelColor = Array.from(this.ctx.getImageData(x, y, 1, 1).data);\n          var hexColor =\n            \"#\" +\n            pixelColor\n              .slice(0, 3)\n              .map((it) => {\n                return it.toString(16).padStart(2, \"0\");\n              })\n              .join(\"\");\n          this.props.onPickColor(hexColor);\n          this.setState({\n            isPickingColor: false,\n          });\n          if (this.canvas) {\n            this.canvas.style.cursor = \"\";\n          }\n        }\n      });\n  };\n\n  setPickColor = () => {\n    this.setState({\n      isPickingColor: true,\n    });\n  };\n\n  componentDidMount() {\n    this.setUpZoomHandler();\n    this.setUpDragHandler();\n    this.setUpPickColorHandler();\n\n    if (this.canvas) {\n      this.canvas.style.imageRendering = \"pixelated\";\n      this.ctx = this.canvas.getContext(\"2d\");\n    }\n\n    this.socket.on(\"initial-pixel-data\", async (pixelData) => {\n      // console.log(pixelData)\n      const image = await createImageFromArrayBuffer(pixelData);\n\n      if (this.canvas) {\n        this.canvas.width = image.width;\n        this.canvas.height = image.height;\n      }\n\n      this.setState({\n        width: image.width,\n        height: image.height,\n      });\n\n      if (this.ctx) {\n        this.ctx.drawImage(image, 0, 0);\n        this.forceUpdate();\n      }\n    });\n\n    this.socket.on(\"update-dot\", ({ row, col, color }) => {\n      // console.log({row, col, color})\n      this.draw(col, row, color);\n    });\n  }\n\n  draw = (row, col, color) => {\n    if (this.ctx) {\n      this.ctx.fillStyle = color;\n      this.ctx.fillRect(row, col, 1, 1);\n    }\n  };\n\n  renderPickColorBtn() {\n    var el = document.getElementById(\"color-pick-placeholder\");\n    if (el) {\n      return ReactDOM.createPortal(\n        <button style={{ marginLeft: \"20px\" }} onClick={this.setPickColor}>\n          {this.state.isPickingColor ? \"正在取色\" : \"取色\"}\n        </button>,\n        el\n      );\n    } else {\n      return null;\n    }\n  }\n\n  render() {\n    // console.log(\"PixelGrid render\")\n    return (\n      <div\n        style={{\n          width: this.state.width,\n          height: this.state.height,\n          overflow: \"hidden\",\n          margin: \"20px\",\n          display: \"inline-block\",\n          border: \"1px solid\",\n          position: \"relative\",\n        }}\n      >\n        {this.renderPickColorBtn()}\n        <div\n          ref={(el) => (this.canvasWrapper = el)}\n          className=\"canvas-wrapper\"\n          style={{\n            position: \"absolute\",\n            left: 0,\n            top: 0,\n          }}\n        >\n          <span\n            className=\"dot-hover-box\"\n            style={{\n              boxShadow: \"0 0 1px black\",\n              width: this.state.zoomLevel + \"px\",\n              height: this.state.zoomLevel + \"px\",\n              position: \"absolute\",\n              left: this.state.dotHoveX * this.state.zoomLevel,\n              top: this.state.dotHoveY * this.state.zoomLevel,\n              zIndex: 8,\n              pointerEvents: \"none\",\n            }}\n          ></span>\n          <canvas\n            style={{\n              ...canvasStyle,\n              // zoom: this.state.zoomLevel\n              transform: \"scale(\" + this.state.zoomLevel + \")\",\n              // 解决像素点不准的问题\n              transformOrigin: \"top left\",\n            }}\n            ref={(el) => (this.canvas = el)}\n          ></canvas>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default PixelGrid;\n","// import React, { Component } from \"react\";\nimport React from \"react\";\n\nconst colors = [\n  \"#ffffff\",\n  \"#000000\",\n  \"#ff0000\",\n  \"#ffa500\",\n  \"#ffff00\",\n  \"#00ff00\",\n  \"#00ffff\",\n  \"#0000ff\",\n  \"#800080\",\n];\n\nconst ulStyle: any = {\n  margin: 0,\n  padding: 0,\n  marginLeft: \"20px\",\n  marginRight: \"20px\",\n  float: \"left\",\n};\n\nconst liStyle: any = {\n  float: \"left\",\n  listStyle: \"none\",\n};\nconst btnStyle: any = {\n  width: \"1em\",\n  height: \"1em\",\n};\n\nfunction ColorSelect(props) {\n  return (\n    <div>\n      <input\n        type=\"color\"\n        value={props.color}\n        onChange={(e) => props.onChange(e.target.value)}\n      />\n      <ul style={ulStyle}>\n        {colors.map((color) => (\n          <li style={liStyle} key={color}>\n            <button\n              onClick={() => props.onChange(color)}\n              style={{ ...btnStyle, backgroundColor: color }}\n            ></button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nexport default ColorSelect;\n","import React, { useState } from \"react\";\n// import { useState } from \"react\";\n\nfunction useOnlineCount(socket) {\n  var [count, setCount] = useState(0);\n  socket.on(\"online-count\", setCount);\n  return count;\n}\n\nfunction OnlineCount({ socket }) {\n  var count = useOnlineCount(socket);\n\n  return <div style={{ margin: \"20px\" }}>在线人数: {count}</div>;\n}\n\nexport default OnlineCount;\n","import React, { Component } from \"react\";\nimport io from \"socket.io-client\";\nimport \"./App.css\";\nimport PixelGrid from \"./PixelGrid\";\nimport ColorSelect from \"./ColorSelect\";\nimport OnlineCount from \"./OnlineCount\";\n// import { produce } from \"immer\";\n// import _ from \"lodash\";\n\n/**\n * 放大、拖拽、取色、限制频率、人数、页面内实时聊天\n * 批量更新而不是单点更新\n * PureComponent\n * Hooks\n * ReactDOM.createPortal\n * socket.io\n * canvas\n * Jimp\n * ArrayBuffer to image\n */\n\nclass App extends Component {\n  state: any = {\n    pixelData: [],\n    currentColor: \"#ff0000\",\n  };\n  socket: any = io(\"http://localhost:3001\");\n\n  componentDidMount() {}\n\n  handlePixelClick = (row, col) => {};\n\n  changeCurrentColor = (color) => {\n    // console.log(color)\n    this.setState({\n      currentColor: color,\n    });\n  };\n\n  render() {\n    // console.log(this.state.pixelData)\n    return (\n      <div>\n        {/* <h1>pixel data</h1> */}\n        <PixelGrid\n          onPickColor={this.changeCurrentColor}\n          width={200}\n          height={200}\n          currentColor={this.state.currentColor}\n          onPixelClick={this.handlePixelClick}\n          socket={this.socket}\n        ></PixelGrid>\n        <ColorSelect\n          onChange={this.changeCurrentColor}\n          color={this.state.currentColor}\n        ></ColorSelect>\n        <OnlineCount socket={this.socket}></OnlineCount>\n        <span id=\"color-pick-placeholder\"></span>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import ReactDOM from 'react-dom';\nimport React from 'react';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\n// class App1 extends React.Component {\n//   socket\n//   constructor (){\n//     super()\n//     this.socket = io()\n//   }\n//   render() {\n//     return <div>1</div>\n//   }\n// }\n\nReactDOM.render(React.createElement(App), document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}